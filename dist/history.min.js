/**
 * @ngdoc overview
 * @name history
 *
 *
 * @description
 * History is the module of Barney that provide you some methods about browser history.
 *
 * # Import module
 * To import History module, include barney.history to 
 * your web application module (usually in app.js file)
 * <pre>
 * angular.module('yourApplicationModule', [
 *     'barney.history'
 * ])
 * </pre>
 * 
 * Remember to include the external javascript files you need:
 *
 * <pre>
 *
 *	  <!-- History module -->
 *   <script type="text/javascript" src="./bower_components/barney/history/history.mod.js"> 
 *
 *	  <!-- History service -->
 *   <script type="text/javascript" src="./bower_components/barney/history/history.ser.js"> 
 *
 * </pre>
 *
 * # Init History
 * Before using History module, it must be initialized. 
 * To initialize History you can use the History method {@link history.BarneyHistory#methods_init init}.
 */
angular.module('barney.history', []);
/**
 * @ngdoc object
 * @name history.BarneyHistory
 *
 * @description
 * Use History service
 *
 * To use History service, you have to add BarneyHistory dependency to your component (i.e: directive, controller...).
 *
 * In this example, I have added dependency of BarneyHistory to a controller:
 * <pre>
 * angular.module('mock').controller('HomePageController', [
 *     'BarneyHistory', '$scope',
 *     function(History, $scope){
 *         // we can use "History" object here
 *     }
 * ]);
 * </pre>
 * Note that I included BarneyHistory as dependency but I have renamed it as History to use it more easily in controller code.
 */
angular.module('barney.history').factory('BarneyHistory',
    ['$location', '$rootScope',
    function($location, $rootScope){
        
        return {

            previousPath: null,
            
            /**
             * @ngdoc function
             * @name history.BarneyHistory#init
             * @methodOf history.BarneyHistory
             *
             * @description 
             * When this method is called, the last visited page is saved and 
             * it can be used by get() and goBack() methods.
             *
             * @example
             * <pre>
             *   History.init();
             * </pre>
             */
            init: function(){
                var _this = this;
                $rootScope.$on('$locationChangeSuccess', function(event, newurl, oldurl){
                    if(newurl !== oldurl){
                        _this.previousPath = oldurl.substr(oldurl.indexOf('#!') + 2);
                    }
                });
            },

            /**
             * @ngdoc function
             * @name history.BarneyHistory#get
             * @methodOf history.BarneyHistory
             *
             * @description 
             * This method is used to get the URL of the last visited page.
             *
             * To use this method, the init method must be called before.
             *
             * @example
             * # History Get 
             * Here is an example of the get method.
             * <pre>
             * 
             *   console.log( History.get() );
             *
             * </pre>
             * 
            */
            get: function(){
                var _this = this;
                return _this.previousPath;
            },

            /**
             * @ngdoc function
             * @name history.BarneyHistory#goBack
             * @methodOf history.BarneyHistory
             *
             * @description 
             * This method is used to go back to the last visited page.
             *
             * To use this method, the init method must be called before.
             *
             * @example
             * # History goBack 
             * Here is an example of the goBack method.
             * <pre>
             * 
             *   History.goBack();
             *
             * </pre>
             * 
            */
            goBack: function(){
                var _this = this;
                $location.url(_this.previousPath);
            }

        };

    }
]);